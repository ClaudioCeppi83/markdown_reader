<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Reader</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a more modern look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #111827; /* bg-gray-900 */
        }
        ::-webkit-scrollbar-thumb {
            background: #374151; /* bg-gray-700 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4b5563; /* bg-gray-600 */
        }
        #editor {
            font-family: 'Fira Code', monospace;
        }
        /* Ensure headers have distinct sizes */
        .prose h1 { font-size: 2.25em; }
        .prose h2 { font-size: 1.75em; }
        .prose h3 { font-size: 1.375em; }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700 px-4 py-2 flex items-center justify-between w-full">
        <h1 class="text-lg font-bold">Markdown Reader</h1>
        <div>
            <input type="file" id="file-input" class="hidden" accept=".md,.markdown,.txt">
            <label for="file-input" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded cursor-pointer">
                Open File
            </label>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex-grow grid grid-cols-2 gap-4 p-4">
        <!-- Editor Panel -->
        <div class="flex flex-col h-full">
            <h2 class="text-md font-semibold mb-2 text-gray-400">Editor</h2>
            <textarea id="editor" class="flex-grow bg-gray-800 border border-gray-700 rounded-md p-4 w-full h-full resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
        </div>

        <!-- Preview Panel -->
        <div class="flex flex-col h-full">
            <h2 class="text-md font-semibold mb-2 text-gray-400">Preview</h2>
            <div id="preview" class="prose prose-invert bg-gray-800 border border-gray-700 rounded-md p-4 w-full h-full overflow-y-auto max-w-none"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editor = document.getElementById('editor');
            const preview = document.getElementById('preview');
            const fileInput = document.getElementById('file-input');

            // Configure Showdown
            const converter = new showdown.Converter({
                ghCompatibleHeaderId: true,
                simpleLineBreaks: true, // Automatically convert single newlines to <br>
                strikethrough: true,
                tables: true,
                tasklists: true,
                emoji: true
            });

            // Function to update the preview
            function updatePreview() {
                const markdownText = editor.value;
                const html = converter.makeHtml(markdownText);
                preview.innerHTML = html;
                // After updating HTML, find and highlight all code blocks
                preview.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
            }

            // Sync editor content to preview in real-time
            editor.addEventListener('input', updatePreview);

            // Handle file opening
            fileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        editor.value = e.target.result;
                        updatePreview(); // Update preview after loading file
                    };
                    reader.onerror = function() {
                        // Placeholder for error handling
                        console.error("Failed to read file.");
                        alert("Error: Could not read the selected file.");
                    };
                    reader.readAsText(file);
                }
            });

            // Initial placeholder content
            editor.value = '# Welcome to Markdown Reader!\n\n' +
                'This is a minimalist, real-time Markdown viewer. Start typing in the editor on the left, and see the formatted output on the right instantly.\n\n' +
                '---\n\n' +
                '## Key Features\n\n' +
                '*   **Live Preview:** Your document is rendered as you type.\n' +
                '*   **Syntax Highlighting:** Code blocks are automatically highlighted.\n' +
                '*   **GitHub Flavored Markdown:** Supports tables, strikethrough, and more.\n\n' +
                '### Examples\n\n' +
                '> Blockquotes are perfect for highlighting important information.\n\n' +
                '**Tables are easy to create:**\n\n' +
                '| Feature         | Status      |\n' +
                '| --------------- | ----------- |\n' +
                '| Real-time Sync  | ✅ Complete |\n' +
                '| File Opening    | ✅ Complete |\n' +
                '| Code Highlighting| ✅ Complete |\n\n' +
                '**Code blocks with syntax highlighting:**\n\n' +
                '```python\n' +
                '# Simple Python function\n' +
                'def greet(name):\n' +
                '    return f"Hello, {name}!"\n\n' +
                'print(greet("World"))\n' +
                '```\n\n' +
                'Start by clearing this text or click \'Open File\' to load your own Markdown file.';
            updatePreview();
        });
    </script>

</body>
</html>
